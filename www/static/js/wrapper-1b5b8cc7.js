var de=Object.defineProperty,le=Object.defineProperties;var ue=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,we=Object.prototype.propertyIsEnumerable;var M=(e,t,n)=>t in e?de(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,h=(e,t)=>{for(var n in t||(t={}))he.call(t,n)&&M(e,n,t[n]);if(H)for(var n of H(t))we.call(t,n)&&M(e,n,t[n]);return e},D=(e,t)=>le(e,ue(t));var O=(e,t,n)=>new Promise((s,o)=>{var i=d=>{try{c(n.next(d))}catch(l){o(l)}},r=d=>{try{c(n.throw(d))}catch(l){o(l)}},c=d=>d.done?s(d.value):Promise.resolve(d.value).then(i,r);c((n=n.apply(e,t)).next())});import{g as q}from"./storage-022bdd6b.js";import{az as S,aH as pe,j as W,d as $,o as p,m as v,A as j,ad as I,f as a,aI as K,aJ as x,aK as N,aL as X,aM as Y,c as m,aN as J,aO as Q,L as Z,F as ee,v as y,a5 as F,x as te,r as T,aa as E,w as A,e as z,p as ve,z as ne,aP as C,a6 as R,aQ as B,aR as ge,S as fe}from"./index.js";import{u as oe,c as ye,F as _e,C as b}from"./chartEditStore-f64b45b7.js";import{t as L,F as me,u as Ce,f as Se}from"./index-12b005c5.js";import"./plugin-5340ba33.js";import"./icon-43da1fd8.js";import"./chartLayoutStore-820b26f5.js";import"./tables_list-16bd57ab.js";/* empty css                                                                */import"./SettingItemBox-47fa6e5a.js";import"./CollapseItem-c8fdd4ef.js";import"./useTargetData.hook-2d9c8a4c.js";const Re=(e,t,n,s)=>{const o=e,i=t,r={width:1,height:1},c=parseFloat((o/i).toFixed(5)),d=()=>{const _=parseFloat((window.innerWidth/window.innerHeight).toFixed(5));n&&(_>c?(r.width=parseFloat((window.innerHeight*c/o).toFixed(5)),r.height=parseFloat((window.innerHeight/i).toFixed(5)),n.style.transform=`scale(${r.width}, ${r.height})`):(r.height=parseFloat((window.innerWidth/c/i).toFixed(5)),r.width=parseFloat((window.innerWidth/o).toFixed(5)),n.style.transform=`scale(${r.width}, ${r.height})`),s&&s(r))},l=L(()=>{d()},200);return{calcRate:d,windowResize:()=>{window.addEventListener("resize",l)},unWindowResize:()=>{window.removeEventListener("resize",l)}}},xe=(e,t,n,s)=>{const o=e,i=t,r={width:1,height:1},c=parseFloat((o/i).toFixed(5)),d=()=>{n&&(r.height=parseFloat((window.innerWidth/c/i).toFixed(5)),r.width=parseFloat((window.innerWidth/o).toFixed(5)),n.style.transform=`scale(${r.width}, ${r.height})`,s&&s(r))},l=L(()=>{d()},200);return{calcRate:d,windowResize:()=>{window.addEventListener("resize",l)},unWindowResize:()=>{window.removeEventListener("resize",l)}}},Fe=(e,t,n,s)=>{const o=e,i=t,r={height:1,width:1},c=parseFloat((o/i).toFixed(5)),d=()=>{n&&(r.width=parseFloat((window.innerHeight*c/o).toFixed(5)),r.height=parseFloat((window.innerHeight/i).toFixed(5)),n.style.transform=`scale(${r.width}, ${r.height})`,s&&s(r))},l=L(()=>{d()},200);return{calcRate:d,windowResize:()=>{window.addEventListener("resize",l)},unWindowResize:()=>{window.removeEventListener("resize",l)}}},Ee=(e,t,n,s)=>{const o={width:1,height:1},i=()=>{n&&(o.width=parseFloat((window.innerWidth/e).toFixed(5)),o.height=parseFloat((window.innerHeight/t).toFixed(5)),n.style.transform=`scale(${o.width}, ${o.height})`,s&&s(o))},r=L(()=>{i()},200);return{calcRate:i,windowResize:()=>{window.addEventListener("resize",r)},unWindowResize:()=>{window.removeEventListener("resize",r)}}},se={},G={echarts:pe},re=e=>{if(!e.events)return{};const t={};for(const o in e.events.baseEvent){const i=e.events.baseEvent[o];i&&(t[o]=ze(i))}const n=e.events.advancedEvents||{},s={[S.VNODE_BEFORE_MOUNT](o){se[e.id]=o.component;const i=(n[S.VNODE_BEFORE_MOUNT]||"").trim();V(i,o)},[S.VNODE_MOUNTED](o){const i=(n[S.VNODE_MOUNTED]||"").trim();V(i,o)}};return h(h({},t),s)};function ze(e){try{return new Function(`
      return (
        async function(mouseEvent){
          ${e}
        }
      )`)()}catch(t){console.error(t)}}function V(e,t){try{Function(`
      "use strict";
      return (
        async function(e, components, node_modules){
          const {${Object.keys(G).join()}} = node_modules;
          ${e}
        }
      )`)().bind(t==null?void 0:t.component)(t,se,G)}catch(n){console.error(n)}}const ie=(e,t)=>({zIndex:t+1,left:`${e.x}px`,top:`${e.y}px`}),$e=(e,t)=>({width:`${t?t*e.w:e.w}px`,height:`${t?t*e.h:e.h}px`}),Le=(e,t,n)=>e?{width:`${n?n*e.w:e.w}px`,height:`${n?n*e.h-t:e.h-t}px`}:{},ae=e=>({display:e.hide?"none":"block"}),ce=e=>{const t={};return e&&e.overFlowHidden&&(t.overflow="hidden"),t},ke=e=>{const t=e.selectColor?{background:e.background}:{background:`url(${e.backgroundImage}) center center / cover no-repeat !important`};return h({position:"relative",width:e.width?`${e.width||100}px`:"100%",height:e.height?`${e.height}px`:"100%"},t)};const Oe=$({__name:"index",props:{groupData:{type:Object,required:!0},themeSetting:{type:Object,required:!0},themeColor:{type:Object,required:!0},groupIndex:{type:Number,required:!0}},setup(e){return(t,n)=>(p(!0),v(ee,null,j(e.groupData.groupList,s=>(p(),v("div",{class:I(["chart-item",a(K)(s.styles.animations)]),key:s.id,style:x(h(h(h(h(h(h({},a(ie)(s.attr,e.groupIndex)),a(N)(s.styles)),a(X)(s.styles)),a(ae)(s.status)),a(ce)(s.preview)),a(Y)(s.styles)))},[(p(),m(Z(s.chartConfig.chartKey),J({id:s.id,chartConfig:s,themeSetting:e.themeSetting,themeColor:e.themeColor,style:h({},a($e)(s.attr))},Q(a(re)(s))),null,16,["id","chartConfig","themeSetting","themeColor","style"]))],6))),128))}});var Te=W(Oe,[["__scopeId","data-v-3933053a"]]);const be=$({__name:"index",setup(e){const t=y(!1),{initDataPond:n,clearMittDataPondMap:s}=Ce(),o=oe(),i=l=>{var w;return!!((w=l.chartConfig.filters)!=null&&w.length)},r=l=>{var u;const w=(u=l.chartConfig.filters)==null?void 0:u.map(f=>f.type==_e.DATE&&f.from!="query"?221:450);if(!(w!=null&&w.length))return 0;const g=w==null?void 0:w.reduce((f,k)=>f+k+8),_=g?Math.ceil(g/l.attr.w):0;return _*24+(_-1)*8+16},c=F(()=>o.editCanvasConfig.chartThemeSetting),d=F(()=>{const l=o.editCanvasConfig.chartThemeColor;return ye[l]});return s(),te(()=>{n(o.requestGlobalConfig)}),(l,w)=>{const g=T("n-switch"),_=T("n-text"),P=T("n-space");return p(!0),v(ee,null,j(a(o).componentList,(u,f)=>(p(),v("div",{key:u.id,class:"chart-item",style:x(h(h(h(h(h(h({},a(ie)(u.attr,f)),a(N)(u.styles)),a(X)(u.styles)),a(ae)(u.status)),a(ce)(u.preview)),a(Y)(u.styles)))},[i(u)?(p(),m(a(me),{key:0,class:"filter-content",componentIdx:u.id,attr:u.attr,filters:u.chartConfig.filters,type:u.chartConfig.category},null,8,["componentIdx","attr","filters","type"])):E("",!0),u.chartConfig.key=="TableMergeCell"?(p(),m(P,{key:1},{default:A(()=>[z(g,{value:t.value,"onUpdate:value":w[0]||(w[0]=k=>t.value=k)},null,8,["value"]),z(_,null,{default:A(()=>[ve("\u624B\u52A8\u6EDA\u52A8")]),_:1})]),_:1})):E("",!0),ne("div",{class:I(a(K)(u.styles.animations))},[u.isGroup?(p(),m(a(Te),{key:0,groupData:u,groupIndex:f,themeSetting:a(c),themeColor:a(d)},null,8,["groupData","groupIndex","themeSetting","themeColor"])):(p(),m(Z(u.chartConfig.chartKey),J({key:1,id:u.id,chartConfig:u,themeSetting:a(c),themeColor:a(d),style:h({},a(Le)(u.attr,r(u))),scrollMode:t.value?"manual":"auto"},Q(a(re)(u))),null,16,["id","chartConfig","themeSetting","themeColor","style","scrollMode"]))],2)],4))),128)}}});var U=W(be,[["__scopeId","data-v-61576a4a"]]);const We=e=>{const t=y(!1),n=setInterval(()=>{if(window.$vue.component){clearInterval(n);const s=o=>{window.$vue.component(o.chartConfig.chartKey)||window.$vue.component(o.chartConfig.chartKey,Se(o.chartConfig))};e.componentList.forEach(o=>O(void 0,null,function*(){o.isGroup?o.groupList.forEach(i=>{s(i)}):s(o)})),t.value=!0}},200);return{show:t}},Ie=e=>{const t=y(),n=y(),s=y(e.editCanvasConfig.width),o=y(e.editCanvasConfig.height);return te(()=>{switch(e.editCanvasConfig.previewScaleType){case C.FIT:(()=>{const{calcRate:i,windowResize:r,unWindowResize:c}=Re(s.value,o.value,n.value);i(),r(),R(()=>{c()})})();break;case C.SCROLL_Y:(()=>{const{calcRate:i,windowResize:r,unWindowResize:c}=xe(s.value,o.value,n.value,d=>{const l=t.value;l.style.width=`${s.value*d.width}px`,l.style.height=`${o.value*d.height}px`});i(),r(),R(()=>{c()})})();break;case C.SCROLL_X:(()=>{const{calcRate:i,windowResize:r,unWindowResize:c}=Fe(s.value,o.value,n.value,d=>{const l=t.value;l.style.width=`${s.value*d.width}px`,l.style.height=`${o.value*d.height}px`});i(),r(),R(()=>{c()})})();break;case C.FULL:(()=>{const{calcRate:i,windowResize:r,unWindowResize:c}=Ee(s.value,o.value,n.value);i(),r(),R(()=>{c()})})();break}}),{entityRef:t,previewRef:n}},Ne=e=>{const t=oe();t.requestGlobalConfig=e[b.REQUEST_GLOBAL_CONFIG],t.editCanvasConfig=e[b.EDIT_CANVAS_CONFIG],t.componentList=e[b.COMPONENT_LIST]};const Pe=$({__name:"index",setup(e){let t=q();const n=F(()=>h(h({},ke(t.editCanvasConfig)),N(t.editCanvasConfig))),s=F(()=>{const c=t.editCanvasConfig.previewScaleType;return c===C.SCROLL_Y||c===C.SCROLL_X});Ne(t);const{entityRef:o,previewRef:i}=Ie(t),{show:r}=We(t);return(c,d)=>(p(),v("div",{class:I(`go-preview ${a(t).editCanvasConfig.previewScaleType}`)},[a(s)?(p(),v("div",{key:0,ref_key:"entityRef",ref:o,class:"go-preview-entity"},[ne("div",{ref_key:"previewRef",ref:i,class:"go-preview-scale"},[a(r)?(p(),v("div",{key:0,style:x(a(n))},[z(a(U))],4)):E("",!0)],512)],512)):(p(),v("div",{key:1,ref_key:"previewRef",ref:i,class:"go-preview-scale"},[a(r)?(p(),v("div",{key:0,style:x(a(n))},[z(a(U))],4)):E("",!0)],512))],2))}});var He=W(Pe,[["__scopeId","data-v-21ad7af6"]]);const Qe=$({__name:"wrapper",setup(e){let t=y(Date.now());return[B.JSON,B.CHART].forEach(n=>{!window.opener||window.opener.addEventListener(n,s=>O(this,null,function*(){const o=yield q();ge(fe.GO_CHART_STORAGE_LIST,[D(h({},s.detail),{id:o.id})]),t.value=Date.now()}))}),(n,s)=>(p(),m(He,{key:a(t)}))}});export{Qe as default};
