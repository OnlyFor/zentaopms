var ae=Object.defineProperty,ce=Object.defineProperties;var le=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var de=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var N=(t,e,n)=>e in t?ae(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,h=(t,e)=>{for(var n in e||(e={}))de.call(e,n)&&N(t,n,e[n]);if(P)for(var n of P(e))ue.call(e,n)&&N(t,n,e[n]);return t},H=(t,e)=>ce(t,le(e));var S=(t,e,n)=>new Promise((s,o)=>{var r=c=>{try{d(n.next(c))}catch(u){o(u)}},i=c=>{try{d(n.throw(c))}catch(u){o(u)}},d=c=>c.done?s(c.value):Promise.resolve(c.value).then(r,i);d((n=n.apply(t,e)).next())});import{g as j}from"./storage-252e6d91.js";import{aG as R,bT as he,d as z,h as v,A as V,F as U,o as w,ad as T,f as a,bU as q,aP as F,bV as k,bW as K,bX as X,c as f,bY as Y,bZ as J,L as Q,p as O,q as p,a5 as m,x as I,r as $,a9 as C,w as D,e as E,m as we,z as Z,b_ as _,a6 as x,b$ as M,c0 as pe,S as ve}from"./index.js";import{t as b,u as ee,c as ge,d as fe,O as ye,F as _e,f as Ce,C as L}from"./useSync.hook-ad257921.js";import{i as me,g as Se,a as Re,h as xe,o as Fe,f as Ee}from"./useItem.hook-a2d87845.js";import"./plugin-08559099.js";import"./icon-18666edb.js";import"./tables_list-38e71280.js";const ze=(t,e,n,s)=>{const o=t,r=e,i={width:1,height:1},d=parseFloat((o/r).toFixed(5)),c=()=>{const l=parseFloat((window.innerWidth/window.innerHeight).toFixed(5));n&&(l>d?(i.width=parseFloat((window.innerHeight*d/o).toFixed(5)),i.height=parseFloat((window.innerHeight/r).toFixed(5)),n.style.transform=`scale(${i.width}, ${i.height})`):(i.height=parseFloat((window.innerWidth/d/r).toFixed(5)),i.width=parseFloat((window.innerWidth/o).toFixed(5)),n.style.transform=`scale(${i.width}, ${i.height})`),s&&s(i))},u=b(()=>{c()},200);return{calcRate:c,windowResize:()=>{window.addEventListener("resize",u)},unWindowResize:()=>{window.removeEventListener("resize",u)}}},be=(t,e,n,s)=>{const o=t,r=e,i={width:1,height:1},d=parseFloat((o/r).toFixed(5)),c=()=>{n&&(i.height=parseFloat((window.innerWidth/d/r).toFixed(5)),i.width=parseFloat((window.innerWidth/o).toFixed(5)),n.style.transform=`scale(${i.width}, ${i.height})`,s&&s(i))},u=b(()=>{c()},200);return{calcRate:c,windowResize:()=>{window.addEventListener("resize",u)},unWindowResize:()=>{window.removeEventListener("resize",u)}}},$e=(t,e,n,s)=>{const o=t,r=e,i={height:1,width:1},d=parseFloat((o/r).toFixed(5)),c=()=>{n&&(i.width=parseFloat((window.innerHeight*d/o).toFixed(5)),i.height=parseFloat((window.innerHeight/r).toFixed(5)),n.style.transform=`scale(${i.width}, ${i.height})`,s&&s(i))},u=b(()=>{c()},200);return{calcRate:c,windowResize:()=>{window.addEventListener("resize",u)},unWindowResize:()=>{window.removeEventListener("resize",u)}}},Le=(t,e,n,s)=>{const o={width:1,height:1},r=()=>{n&&(o.width=parseFloat((window.innerWidth/t).toFixed(5)),o.height=parseFloat((window.innerHeight/e).toFixed(5)),n.style.transform=`scale(${o.width}, ${o.height})`,s&&s(o))},i=b(()=>{r()},200);return{calcRate:r,windowResize:()=>{window.addEventListener("resize",i)},unWindowResize:()=>{window.removeEventListener("resize",i)}}},te={},A={echarts:he},ne=t=>{if(!t.events)return{};const e={};for(const o in t.events.baseEvent){const r=t.events.baseEvent[o];r&&(e[o]=Te(r))}const n=t.events.advancedEvents||{},s={[R.VNODE_BEFORE_MOUNT](o){te[t.id]=o.component;const r=(n[R.VNODE_BEFORE_MOUNT]||"").trim();G(r,o)},[R.VNODE_MOUNTED](o){const r=(n[R.VNODE_MOUNTED]||"").trim();G(r,o)}};return h(h({},e),s)};function Te(t){try{return new Function(`
      return (
        async function(mouseEvent){
          ${t}
        }
      )`)()}catch(e){console.error(e)}}function G(t,e){try{Function(`
      "use strict";
      return (
        async function(e, components, node_modules){
          const {${Object.keys(A).join()}} = node_modules;
          ${t}
        }
      )`)().bind(e==null?void 0:e.component)(e,te,A)}catch(n){console.error(n)}}const oe=(t,e)=>({zIndex:e+1,left:`${t.x}px`,top:`${t.y}px`}),ke=(t,e)=>({width:`${e?e*t.w:t.w}px`,height:`${e?e*t.h:t.h}px`}),Oe=(t,e,n)=>t?{width:`${n?n*t.w:t.w}px`,height:`${n?n*t.h-e:t.h-e}px`}:{},se=t=>({display:t.hide?"none":"block"}),ie=t=>{const e={};return t&&t.overFlowHidden&&(e.overflow="hidden"),e},Ie=t=>{const e=t.selectColor?{background:t.background}:{background:`url(${t.backgroundImage}) center center / cover no-repeat !important`};return h({position:"relative",width:t.width?`${t.width||100}px`:"100%",height:t.height?`${t.height}px`:"100%"},e)};const We=z({__name:"index",props:{groupData:{type:Object,required:!0},themeSetting:{type:Object,required:!0},themeColor:{type:Object,required:!0},groupIndex:{type:Number,required:!0}},setup(t){return(e,n)=>(w(!0),v(U,null,V(t.groupData.groupList,s=>(w(),v("div",{class:T(["chart-item",a(q)(s.styles.animations)]),key:s.id,style:F(h(h(h(h(h(h({},a(oe)(s.attr,t.groupIndex)),a(k)(s.styles)),a(K)(s.styles)),a(se)(s.status)),a(ie)(s.preview)),a(X)(s.styles)))},[(w(),f(Q(s.chartConfig.chartKey),Y({id:s.id,chartConfig:s,themeSetting:t.themeSetting,themeColor:t.themeColor,style:h({},a(ke)(s.attr))},J(a(ne)(s))),null,16,["id","chartConfig","themeSetting","themeColor","style"]))],6))),128))}});var Pe=O(We,[["__scopeId","data-v-3933053a"]]);const Ne=z({__name:"index",setup(t){const e=p(!1),{initDataPond:n,clearMittDataPondMap:s}=ge(),o=ee(),r=m(()=>o.editCanvasConfig.chartThemeSetting),i=m(()=>{const d=o.editCanvasConfig.chartThemeColor;return fe[d]});return s(),I(()=>{n(o.requestGlobalConfig)}),(d,c)=>{const u=$("n-switch"),g=$("n-text"),y=$("n-space");return w(!0),v(U,null,V(a(o).componentList,(l,W)=>(w(),v("div",{key:l.id,class:"chart-item",style:F(h(h(h(h(h(h({},a(oe)(l.attr,W)),a(k)(l.styles)),a(K)(l.styles)),a(se)(l.status)),a(ie)(l.preview)),a(X)(l.styles)))},[a(me)(l)?(w(),f(a(ye),{key:0,title:a(Se)(l),attr:l.attr,titleSize:a(Re)(l)},null,8,["title","attr","titleSize"])):C("",!0),a(xe)(l)?(w(),f(a(_e),{key:1,class:"filter-content",componentIdx:l.id,attr:l.attr,filters:l.chartConfig.filters,type:l.chartConfig.category},null,8,["componentIdx","attr","filters","type"])):C("",!0),l.chartConfig.key=="TableMergeCell"?(w(),f(y,{key:2},{default:D(()=>[E(u,{value:e.value,"onUpdate:value":c[0]||(c[0]=re=>e.value=re)},null,8,["value"]),E(g,null,{default:D(()=>[we("\u624B\u52A8\u6EDA\u52A8")]),_:1})]),_:1})):C("",!0),Z("div",{class:T(a(q)(l.styles.animations))},[l.isGroup?(w(),f(a(Pe),{key:0,groupData:l,groupIndex:W,themeSetting:r.value,themeColor:i.value},null,8,["groupData","groupIndex","themeSetting","themeColor"])):(w(),f(Q(l.chartConfig.chartKey),Y({key:1,id:l.id,chartConfig:l,themeSetting:r.value,themeColor:i.value,style:h({},a(Oe)(l.attr,a(Fe)(l)+a(Ee)(l))),scrollMode:e.value?"manual":"auto"},J(a(ne)(l))),null,16,["id","chartConfig","themeSetting","themeColor","style","scrollMode"]))],2)],4))),128)}}});var B=O(Ne,[["__scopeId","data-v-4a170266"]]);const He=t=>{const e=p(!1),n=setInterval(()=>{if(window.$vue.component){clearInterval(n);const s=o=>{window.$vue.component(o.chartConfig.chartKey)||window.$vue.component(o.chartConfig.chartKey,Ce(o.chartConfig))};t.componentList.forEach(o=>S(void 0,null,function*(){o.isGroup?o.groupList.forEach(r=>{s(r)}):s(o)})),e.value=!0}},200);return{show:e}},De=t=>{const e=p(),n=p(),s=p(t.editCanvasConfig.width),o=p(t.editCanvasConfig.height);return I(()=>{switch(t.editCanvasConfig.previewScaleType){case _.FIT:(()=>{const{calcRate:r,windowResize:i,unWindowResize:d}=ze(s.value,o.value,n.value);r(),i(),x(()=>{d()})})();break;case _.SCROLL_Y:(()=>{const{calcRate:r,windowResize:i,unWindowResize:d}=be(s.value,o.value,n.value,c=>{const u=e.value;u.style.width=`${s.value*c.width}px`,u.style.height=`${o.value*c.height}px`});r(),i(),x(()=>{d()})})();break;case _.SCROLL_X:(()=>{const{calcRate:r,windowResize:i,unWindowResize:d}=$e(s.value,o.value,n.value,c=>{const u=e.value;u.style.width=`${s.value*c.width}px`,u.style.height=`${o.value*c.height}px`});r(),i(),x(()=>{d()})})();break;case _.FULL:(()=>{const{calcRate:r,windowResize:i,unWindowResize:d}=Le(s.value,o.value,n.value);r(),i(),x(()=>{d()})})();break}}),{entityRef:e,previewRef:n}},Me=t=>{const e=ee();return e.requestGlobalConfig=t[L.REQUEST_GLOBAL_CONFIG],e.editCanvasConfig=t[L.EDIT_CANVAS_CONFIG],e.componentList=t[L.COMPONENT_LIST],e};const Ae=z({__name:"index",setup(t){let e=p(j()),n=p(),s=p(),o=p();const r=m(()=>h(h({},Ie(e.value.editCanvasConfig)),k(e.value.editCanvasConfig))),i=m(()=>{const c=e.value.editCanvasConfig.previewScaleType;return c===_.SCROLL_Y||c===_.SCROLL_X}),d=m(()=>e.value);return I(()=>S(this,null,function*(){try{const u=yield(yield fetch(window.fetchScreenSchemeApi,{method:"GET"})).json();e.value=u.chartData,Me(e.value);const g=De(e.value),y=He(e.value);n=g.entityRef,s=g.previewRef,o=y.show}catch(c){console.log(c)}})),(c,u)=>d.value?(w(),v("div",{key:0,class:T(`go-preview ${a(e).editCanvasConfig.previewScaleType}`)},[i.value?(w(),v("div",{key:0,ref_key:"entityRef",ref:n,class:"go-preview-entity"},[Z("div",{ref_key:"previewRef",ref:s,class:"go-preview-scale"},[a(o)?(w(),v("div",{key:0,style:F(r.value)},[E(a(B))],4)):C("",!0)],512)],512)):(w(),v("div",{key:1,ref_key:"previewRef",ref:s,class:"go-preview-scale"},[a(o)?(w(),v("div",{key:0,style:F(r.value)},[E(a(B))],4)):C("",!0)],512))],2)):C("",!0)}});var Ge=O(Ae,[["__scopeId","data-v-0466af7c"]]);const Je=z({__name:"wrapper",setup(t){let e=p(Date.now());return[M.JSON,M.CHART].forEach(n=>{!window.opener||window.opener.addEventListener(n,s=>S(this,null,function*(){const o=yield j();pe(ve.GO_CHART_STORAGE_LIST,[H(h({},s.detail),{id:o.id})]),e.value=Date.now()}))}),(n,s)=>(w(),f(Ge,{key:a(e)}))}});export{Je as default};
