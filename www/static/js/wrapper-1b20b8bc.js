var le=Object.defineProperty,ue=Object.defineProperties;var he=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var we=Object.prototype.hasOwnProperty,pe=Object.prototype.propertyIsEnumerable;var D=(e,t,n)=>t in e?le(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,u=(e,t)=>{for(var n in t||(t={}))we.call(t,n)&&D(e,n,t[n]);if(H)for(var n of H(t))pe.call(t,n)&&D(e,n,t[n]);return e},M=(e,t)=>ue(e,he(t));var b=(e,t,n)=>new Promise((s,o)=>{var r=l=>{try{d(n.next(l))}catch(h){o(h)}},i=l=>{try{d(n.throw(l))}catch(h){o(h)}},d=l=>l.done?s(l.value):Promise.resolve(l.value).then(r,i);d((n=n.apply(e,t)).next())});import{g as j}from"./storage-ce5c85d6.js";import{aG as m,bT as ve,d as E,h as p,A as q,F as K,o as w,ad as k,f as a,bU as X,aP as x,bV as O,bW as Y,bX as J,c as v,bY as Q,bZ as Z,L as ee,p as T,q as g,a5 as R,x as te,r as $,a9 as y,w as A,e as F,m as ge,z as ne,b_ as f,a6 as S,b$ as B,c0 as fe,S as ye}from"./index.js";import{t as z,u as oe,c as _e,d as Ce,O as me,F as Se,f as xe,C as L}from"./useSync.hook-30fcda9e.js";import{i as Re,h as Fe,o as Ee,f as ze}from"./useItem.hook-a82690a5.js";import"./plugin-ed432b2e.js";import"./icon-33306844.js";import"./tables_list-38e71280.js";const be=(e,t,n,s)=>{const o=e,r=t,i={width:1,height:1},d=parseFloat((o/r).toFixed(5)),l=()=>{const c=parseFloat((window.innerWidth/window.innerHeight).toFixed(5));n&&(c>d?(i.width=parseFloat((window.innerHeight*d/o).toFixed(5)),i.height=parseFloat((window.innerHeight/r).toFixed(5)),n.style.transform=`scale(${i.width}, ${i.height})`):(i.height=parseFloat((window.innerWidth/d/r).toFixed(5)),i.width=parseFloat((window.innerWidth/o).toFixed(5)),n.style.transform=`scale(${i.width}, ${i.height})`),s&&s(i))},h=z(()=>{l()},200);return{calcRate:l,windowResize:()=>{window.addEventListener("resize",h)},unWindowResize:()=>{window.removeEventListener("resize",h)}}},$e=(e,t,n,s)=>{const o=e,r=t,i={width:1,height:1},d=parseFloat((o/r).toFixed(5)),l=()=>{n&&(i.height=parseFloat((window.innerWidth/d/r).toFixed(5)),i.width=parseFloat((window.innerWidth/o).toFixed(5)),n.style.transform=`scale(${i.width}, ${i.height})`,s&&s(i))},h=z(()=>{l()},200);return{calcRate:l,windowResize:()=>{window.addEventListener("resize",h)},unWindowResize:()=>{window.removeEventListener("resize",h)}}},Le=(e,t,n,s)=>{const o=e,r=t,i={height:1,width:1},d=parseFloat((o/r).toFixed(5)),l=()=>{n&&(i.width=parseFloat((window.innerHeight*d/o).toFixed(5)),i.height=parseFloat((window.innerHeight/r).toFixed(5)),n.style.transform=`scale(${i.width}, ${i.height})`,s&&s(i))},h=z(()=>{l()},200);return{calcRate:l,windowResize:()=>{window.addEventListener("resize",h)},unWindowResize:()=>{window.removeEventListener("resize",h)}}},ke=(e,t,n,s)=>{const o={width:1,height:1},r=()=>{n&&(o.width=parseFloat((window.innerWidth/e).toFixed(5)),o.height=parseFloat((window.innerHeight/t).toFixed(5)),n.style.transform=`scale(${o.width}, ${o.height})`,s&&s(o))},i=z(()=>{r()},200);return{calcRate:r,windowResize:()=>{window.addEventListener("resize",i)},unWindowResize:()=>{window.removeEventListener("resize",i)}}},se={},G={echarts:ve},ie=e=>{if(!e.events)return{};const t={};for(const o in e.events.baseEvent){const r=e.events.baseEvent[o];r&&(t[o]=Oe(r))}const n=e.events.advancedEvents||{},s={[m.VNODE_BEFORE_MOUNT](o){se[e.id]=o.component;const r=(n[m.VNODE_BEFORE_MOUNT]||"").trim();V(r,o)},[m.VNODE_MOUNTED](o){const r=(n[m.VNODE_MOUNTED]||"").trim();V(r,o)}};return u(u({},t),s)};function Oe(e){try{return new Function(`
      return (
        async function(mouseEvent){
          ${e}
        }
      )`)()}catch(t){console.error(t)}}function V(e,t){try{Function(`
      "use strict";
      return (
        async function(e, components, node_modules){
          const {${Object.keys(G).join()}} = node_modules;
          ${e}
        }
      )`)().bind(t==null?void 0:t.component)(t,se,G)}catch(n){console.error(n)}}const re=(e,t)=>({zIndex:t+1,left:`${e.x}px`,top:`${e.y}px`}),Te=(e,t)=>({width:`${t?t*e.w:e.w}px`,height:`${t?t*e.h:e.h}px`}),We=(e,t,n)=>e?{width:`${n?n*e.w:e.w}px`,height:`${n?n*e.h-t:e.h-t}px`}:{},ae=e=>({display:e.hide?"none":"block"}),ce=e=>{const t={};return e&&e.overFlowHidden&&(t.overflow="hidden"),t},Pe=e=>{const t=e.selectColor?{background:e.background}:{background:`url(${e.backgroundImage}) center center / cover no-repeat !important`};return u({position:"relative",width:e.width?`${e.width||100}px`:"100%",height:e.height?`${e.height}px`:"100%"},t)};const Ie=E({__name:"index",props:{groupData:{type:Object,required:!0},themeSetting:{type:Object,required:!0},themeColor:{type:Object,required:!0},groupIndex:{type:Number,required:!0}},setup(e){return(t,n)=>(w(!0),p(K,null,q(e.groupData.groupList,s=>(w(),p("div",{class:k(["chart-item",a(X)(s.styles.animations)]),key:s.id,style:x(u(u(u(u(u(u({},a(re)(s.attr,e.groupIndex)),a(O)(s.styles)),a(Y)(s.styles)),a(ae)(s.status)),a(ce)(s.preview)),a(J)(s.styles)))},[(w(),v(ee(s.chartConfig.chartKey),Q({id:s.id,chartConfig:s,themeSetting:e.themeSetting,themeColor:e.themeColor,style:u({},a(Te)(s.attr))},Z(a(ie)(s))),null,16,["id","chartConfig","themeSetting","themeColor","style"]))],6))),128))}});var Ne=T(Ie,[["__scopeId","data-v-3933053a"]]);const He=E({__name:"index",setup(e){const t=g(!1),{initDataPond:n,clearMittDataPondMap:s}=_e(),o=oe(),r=R(()=>o.editCanvasConfig.chartThemeSetting),i=R(()=>{const d=o.editCanvasConfig.chartThemeColor;return Ce[d]});return s(),te(()=>{n(o.requestGlobalConfig)}),(d,l)=>{const h=$("n-switch"),_=$("n-text"),C=$("n-space");return w(!0),p(K,null,q(a(o).componentList,(c,W)=>{var P,I,N;return w(),p("div",{key:c.id,class:"chart-item",style:x(u(u(u(u(u(u({},a(re)(c.attr,W)),a(O)(c.styles)),a(Y)(c.styles)),a(ae)(c.status)),a(ce)(c.preview)),a(J)(c.styles)))},[a(Re)(c)?(w(),v(a(me),{key:0,title:c.chartConfig.package=="Charts"&&(N=(I=(P=c.option)==null?void 0:P.title)==null?void 0:I.text)!=null?N:c.chartConfig.title,attr:c.attr},null,8,["title","attr"])):y("",!0),a(Fe)(c)?(w(),v(a(Se),{key:1,class:"filter-content",componentIdx:c.id,attr:c.attr,filters:c.chartConfig.filters,type:c.chartConfig.category},null,8,["componentIdx","attr","filters","type"])):y("",!0),c.chartConfig.key=="TableMergeCell"?(w(),v(C,{key:2},{default:A(()=>[F(h,{value:t.value,"onUpdate:value":l[0]||(l[0]=de=>t.value=de)},null,8,["value"]),F(_,null,{default:A(()=>[ge("\u624B\u52A8\u6EDA\u52A8")]),_:1})]),_:1})):y("",!0),ne("div",{class:k(a(X)(c.styles.animations))},[c.isGroup?(w(),v(a(Ne),{key:0,groupData:c,groupIndex:W,themeSetting:r.value,themeColor:i.value},null,8,["groupData","groupIndex","themeSetting","themeColor"])):(w(),v(ee(c.chartConfig.chartKey),Q({key:1,id:c.id,chartConfig:c,themeSetting:r.value,themeColor:i.value,style:u({},a(We)(c.attr,a(Ee)(c)+a(ze)(c))),scrollMode:t.value?"manual":"auto"},Z(a(ie)(c))),null,16,["id","chartConfig","themeSetting","themeColor","style","scrollMode"]))],2)],4)}),128)}}});var U=T(He,[["__scopeId","data-v-00a60e7e"]]);const De=e=>{const t=g(!1),n=setInterval(()=>{if(window.$vue.component){clearInterval(n);const s=o=>{window.$vue.component(o.chartConfig.chartKey)||window.$vue.component(o.chartConfig.chartKey,xe(o.chartConfig))};e.componentList.forEach(o=>b(void 0,null,function*(){o.isGroup?o.groupList.forEach(r=>{s(r)}):s(o)})),t.value=!0}},200);return{show:t}},Me=e=>{const t=g(),n=g(),s=g(e.editCanvasConfig.width),o=g(e.editCanvasConfig.height);return te(()=>{switch(e.editCanvasConfig.previewScaleType){case f.FIT:(()=>{const{calcRate:r,windowResize:i,unWindowResize:d}=be(s.value,o.value,n.value);r(),i(),S(()=>{d()})})();break;case f.SCROLL_Y:(()=>{const{calcRate:r,windowResize:i,unWindowResize:d}=$e(s.value,o.value,n.value,l=>{const h=t.value;h.style.width=`${s.value*l.width}px`,h.style.height=`${o.value*l.height}px`});r(),i(),S(()=>{d()})})();break;case f.SCROLL_X:(()=>{const{calcRate:r,windowResize:i,unWindowResize:d}=Le(s.value,o.value,n.value,l=>{const h=t.value;h.style.width=`${s.value*l.width}px`,h.style.height=`${o.value*l.height}px`});r(),i(),S(()=>{d()})})();break;case f.FULL:(()=>{const{calcRate:r,windowResize:i,unWindowResize:d}=ke(s.value,o.value,n.value);r(),i(),S(()=>{d()})})();break}}),{entityRef:t,previewRef:n}},Ae=e=>{const t=oe();t.requestGlobalConfig=e[L.REQUEST_GLOBAL_CONFIG],t.editCanvasConfig=e[L.EDIT_CANVAS_CONFIG],t.componentList=e[L.COMPONENT_LIST]};const Be=E({__name:"index",setup(e){let t=j();const n=R(()=>u(u({},Pe(t.editCanvasConfig)),O(t.editCanvasConfig))),s=R(()=>{const d=t.editCanvasConfig.previewScaleType;return d===f.SCROLL_Y||d===f.SCROLL_X});Ae(t);const{entityRef:o,previewRef:r}=Me(t),{show:i}=De(t);return(d,l)=>(w(),p("div",{class:k(`go-preview ${a(t).editCanvasConfig.previewScaleType}`)},[s.value?(w(),p("div",{key:0,ref_key:"entityRef",ref:o,class:"go-preview-entity"},[ne("div",{ref_key:"previewRef",ref:r,class:"go-preview-scale"},[a(i)?(w(),p("div",{key:0,style:x(n.value)},[F(a(U))],4)):y("",!0)],512)],512)):(w(),p("div",{key:1,ref_key:"previewRef",ref:r,class:"go-preview-scale"},[a(i)?(w(),p("div",{key:0,style:x(n.value)},[F(a(U))],4)):y("",!0)],512))],2))}});var Ge=T(Be,[["__scopeId","data-v-21ad7af6"]]);const Qe=E({__name:"wrapper",setup(e){let t=g(Date.now());return[B.JSON,B.CHART].forEach(n=>{!window.opener||window.opener.addEventListener(n,s=>b(this,null,function*(){const o=yield j();fe(ye.GO_CHART_STORAGE_LIST,[M(u({},s.detail),{id:o.id})]),t.value=Date.now()}))}),(n,s)=>(w(),v(Ge,{key:a(t)}))}});export{Qe as default};
