var le=Object.defineProperty,ue=Object.defineProperties;var he=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var we=Object.prototype.hasOwnProperty,pe=Object.prototype.propertyIsEnumerable;var H=(t,e,n)=>e in t?le(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,h=(t,e)=>{for(var n in e||(e={}))we.call(e,n)&&H(t,n,e[n]);if(D)for(var n of D(e))pe.call(e,n)&&H(t,n,e[n]);return t},M=(t,e)=>ue(t,he(e));var S=(t,e,n)=>new Promise((s,o)=>{var r=d=>{try{u(n.next(d))}catch(l){o(l)}},i=d=>{try{u(n.throw(d))}catch(l){o(l)}},u=d=>d.done?s(d.value):Promise.resolve(d.value).then(r,i);u((n=n.apply(t,e)).next())});import{g as U}from"./storage-7b4fa00b.js";import{aG as R,bT as ve,d as z,h as v,A as q,F as K,o as w,ad as k,f as c,bU as X,aP as F,bV as T,bW as Y,bX as J,c as f,bY as Q,bZ as Z,L as ee,p as O,q as p,a5 as m,x as te,r as $,a9 as C,w as A,e as E,m as ge,z as ne,b_ as _,a6 as x,b$ as fe,c0 as B,c1 as ye,S as _e}from"./index.js";import{t as b,u as oe,c as Ce,d as me,O as Se,F as Re,f as xe,C as L}from"./useSync.hook-77adf4de.js";import{i as Fe,h as Ee,o as ze,f as be}from"./useItem.hook-3e098f10.js";import"./plugin-bf1bfb0e.js";import"./icon-bc6d0f16.js";import"./tables_list-38e71280.js";const $e=(t,e,n,s)=>{const o=t,r=e,i={width:1,height:1},u=parseFloat((o/r).toFixed(5)),d=()=>{const a=parseFloat((window.innerWidth/window.innerHeight).toFixed(5));n&&(a>u?(i.width=parseFloat((window.innerHeight*u/o).toFixed(5)),i.height=parseFloat((window.innerHeight/r).toFixed(5)),n.style.transform=`scale(${i.width}, ${i.height})`):(i.height=parseFloat((window.innerWidth/u/r).toFixed(5)),i.width=parseFloat((window.innerWidth/o).toFixed(5)),n.style.transform=`scale(${i.width}, ${i.height})`),s&&s(i))},l=b(()=>{d()},200);return{calcRate:d,windowResize:()=>{window.addEventListener("resize",l)},unWindowResize:()=>{window.removeEventListener("resize",l)}}},Le=(t,e,n,s)=>{const o=t,r=e,i={width:1,height:1},u=parseFloat((o/r).toFixed(5)),d=()=>{n&&(i.height=parseFloat((window.innerWidth/u/r).toFixed(5)),i.width=parseFloat((window.innerWidth/o).toFixed(5)),n.style.transform=`scale(${i.width}, ${i.height})`,s&&s(i))},l=b(()=>{d()},200);return{calcRate:d,windowResize:()=>{window.addEventListener("resize",l)},unWindowResize:()=>{window.removeEventListener("resize",l)}}},ke=(t,e,n,s)=>{const o=t,r=e,i={height:1,width:1},u=parseFloat((o/r).toFixed(5)),d=()=>{n&&(i.width=parseFloat((window.innerHeight*u/o).toFixed(5)),i.height=parseFloat((window.innerHeight/r).toFixed(5)),n.style.transform=`scale(${i.width}, ${i.height})`,s&&s(i))},l=b(()=>{d()},200);return{calcRate:d,windowResize:()=>{window.addEventListener("resize",l)},unWindowResize:()=>{window.removeEventListener("resize",l)}}},Te=(t,e,n,s)=>{const o={width:1,height:1},r=()=>{n&&(o.width=parseFloat((window.innerWidth/t).toFixed(5)),o.height=parseFloat((window.innerHeight/e).toFixed(5)),n.style.transform=`scale(${o.width}, ${o.height})`,s&&s(o))},i=b(()=>{r()},200);return{calcRate:r,windowResize:()=>{window.addEventListener("resize",i)},unWindowResize:()=>{window.removeEventListener("resize",i)}}},se={},G={echarts:ve},ie=t=>{if(!t.events)return{};const e={};for(const o in t.events.baseEvent){const r=t.events.baseEvent[o];r&&(e[o]=Oe(r))}const n=t.events.advancedEvents||{},s={[R.VNODE_BEFORE_MOUNT](o){se[t.id]=o.component;const r=(n[R.VNODE_BEFORE_MOUNT]||"").trim();j(r,o)},[R.VNODE_MOUNTED](o){const r=(n[R.VNODE_MOUNTED]||"").trim();j(r,o)}};return h(h({},e),s)};function Oe(t){try{return new Function(`
      return (
        async function(mouseEvent){
          ${t}
        }
      )`)()}catch(e){console.error(e)}}function j(t,e){try{Function(`
      "use strict";
      return (
        async function(e, components, node_modules){
          const {${Object.keys(G).join()}} = node_modules;
          ${t}
        }
      )`)().bind(e==null?void 0:e.component)(e,se,G)}catch(n){console.error(n)}}const re=(t,e)=>({zIndex:e+1,left:`${t.x}px`,top:`${t.y}px`}),We=(t,e)=>({width:`${e?e*t.w:t.w}px`,height:`${e?e*t.h:t.h}px`}),Ie=(t,e,n)=>t?{width:`${n?n*t.w:t.w}px`,height:`${n?n*t.h-e:t.h-e}px`}:{},ae=t=>({display:t.hide?"none":"block"}),ce=t=>{const e={};return t&&t.overFlowHidden&&(e.overflow="hidden"),e},Pe=t=>{const e=t.selectColor?{background:t.background}:{background:`url(${t.backgroundImage}) center center / cover no-repeat !important`};return h({position:"relative",width:t.width?`${t.width||100}px`:"100%",height:t.height?`${t.height}px`:"100%"},e)};const Ne=z({__name:"index",props:{groupData:{type:Object,required:!0},themeSetting:{type:Object,required:!0},themeColor:{type:Object,required:!0},groupIndex:{type:Number,required:!0}},setup(t){return(e,n)=>(w(!0),v(K,null,q(t.groupData.groupList,s=>(w(),v("div",{class:k(["chart-item",c(X)(s.styles.animations)]),key:s.id,style:F(h(h(h(h(h(h({},c(re)(s.attr,t.groupIndex)),c(T)(s.styles)),c(Y)(s.styles)),c(ae)(s.status)),c(ce)(s.preview)),c(J)(s.styles)))},[(w(),f(ee(s.chartConfig.chartKey),Q({id:s.id,chartConfig:s,themeSetting:t.themeSetting,themeColor:t.themeColor,style:h({},c(We)(s.attr))},Z(c(ie)(s))),null,16,["id","chartConfig","themeSetting","themeColor","style"]))],6))),128))}});var De=O(Ne,[["__scopeId","data-v-3933053a"]]);const He=z({__name:"index",setup(t){const e=p(!1),{initDataPond:n,clearMittDataPondMap:s}=Ce(),o=oe(),r=m(()=>o.editCanvasConfig.chartThemeSetting),i=m(()=>{const u=o.editCanvasConfig.chartThemeColor;return me[u]});return s(),te(()=>{n(o.requestGlobalConfig)}),(u,d)=>{const l=$("n-switch"),y=$("n-text"),g=$("n-space");return w(!0),v(K,null,q(c(o).componentList,(a,W)=>{var I,P,N;return w(),v("div",{key:a.id,class:"chart-item",style:F(h(h(h(h(h(h({},c(re)(a.attr,W)),c(T)(a.styles)),c(Y)(a.styles)),c(ae)(a.status)),c(ce)(a.preview)),c(J)(a.styles)))},[c(Fe)(a)?(w(),f(c(Se),{key:0,title:a.chartConfig.package=="Charts"&&(N=(P=(I=a.option)==null?void 0:I.title)==null?void 0:P.text)!=null?N:a.chartConfig.title,attr:a.attr},null,8,["title","attr"])):C("",!0),c(Ee)(a)?(w(),f(c(Re),{key:1,class:"filter-content",componentIdx:a.id,attr:a.attr,filters:a.chartConfig.filters,type:a.chartConfig.category},null,8,["componentIdx","attr","filters","type"])):C("",!0),a.chartConfig.key=="TableMergeCell"?(w(),f(g,{key:2},{default:A(()=>[E(l,{value:e.value,"onUpdate:value":d[0]||(d[0]=de=>e.value=de)},null,8,["value"]),E(y,null,{default:A(()=>[ge("\u624B\u52A8\u6EDA\u52A8")]),_:1})]),_:1})):C("",!0),ne("div",{class:k(c(X)(a.styles.animations))},[a.isGroup?(w(),f(c(De),{key:0,groupData:a,groupIndex:W,themeSetting:r.value,themeColor:i.value},null,8,["groupData","groupIndex","themeSetting","themeColor"])):(w(),f(ee(a.chartConfig.chartKey),Q({key:1,id:a.id,chartConfig:a,themeSetting:r.value,themeColor:i.value,style:h({},c(Ie)(a.attr,c(ze)(a)+c(be)(a))),scrollMode:e.value?"manual":"auto"},Z(c(ie)(a))),null,16,["id","chartConfig","themeSetting","themeColor","style","scrollMode"]))],2)],4)}),128)}}});var V=O(He,[["__scopeId","data-v-00a60e7e"]]);const Me=t=>{const e=p(!1),n=setInterval(()=>{if(window.$vue.component){clearInterval(n);const s=o=>{window.$vue.component(o.chartConfig.chartKey)||window.$vue.component(o.chartConfig.chartKey,xe(o.chartConfig))};t.componentList.forEach(o=>S(void 0,null,function*(){o.isGroup?o.groupList.forEach(r=>{s(r)}):s(o)})),e.value=!0}},200);return{show:e}},Ae=t=>{const e=p(),n=p(),s=p(t.editCanvasConfig.width),o=p(t.editCanvasConfig.height);return te(()=>{switch(t.editCanvasConfig.previewScaleType){case _.FIT:(()=>{const{calcRate:r,windowResize:i,unWindowResize:u}=$e(s.value,o.value,n.value);r(),i(),x(()=>{u()})})();break;case _.SCROLL_Y:(()=>{const{calcRate:r,windowResize:i,unWindowResize:u}=Le(s.value,o.value,n.value,d=>{const l=e.value;l.style.width=`${s.value*d.width}px`,l.style.height=`${o.value*d.height}px`});r(),i(),x(()=>{u()})})();break;case _.SCROLL_X:(()=>{const{calcRate:r,windowResize:i,unWindowResize:u}=ke(s.value,o.value,n.value,d=>{const l=e.value;l.style.width=`${s.value*d.width}px`,l.style.height=`${o.value*d.height}px`});r(),i(),x(()=>{u()})})();break;case _.FULL:(()=>{const{calcRate:r,windowResize:i,unWindowResize:u}=Te(s.value,o.value,n.value);r(),i(),x(()=>{u()})})();break}}),{entityRef:e,previewRef:n}},Be=t=>{const e=oe();return e.requestGlobalConfig=t[L.REQUEST_GLOBAL_CONFIG],e.editCanvasConfig=t[L.EDIT_CANVAS_CONFIG],e.componentList=t[L.COMPONENT_LIST],e};const Ge=z({__name:"index",setup(t){let e=U(),n=p(),s=p(),o=p(),r=p();const i=m(()=>h(h({},Pe(e.editCanvasConfig)),T(e.editCanvasConfig))),u=m(()=>{const l=e.editCanvasConfig.previewScaleType;return l===_.SCROLL_Y||l===_.SCROLL_X}),d=m(()=>r.value);return fe(()=>S(this,null,function*(){try{e=(yield(yield fetch(window.fetchScreenSchemeApi,{method:"GET"})).json()).chartData,r.value=Be(e);const g=Ae(e),a=Me(e);n=g.entityRef,s=g.previewRef,o=a.show}catch(l){console.log(l)}})),(l,y)=>d.value?(w(),v("div",{key:0,class:k(`go-preview ${c(e).editCanvasConfig.previewScaleType}`)},[u.value?(w(),v("div",{key:0,ref_key:"entityRef",ref:n,class:"go-preview-entity"},[ne("div",{ref_key:"previewRef",ref:s,class:"go-preview-scale"},[c(o)?(w(),v("div",{key:0,style:F(i.value)},[E(c(V))],4)):C("",!0)],512)],512)):(w(),v("div",{key:1,ref_key:"previewRef",ref:s,class:"go-preview-scale"},[c(o)?(w(),v("div",{key:0,style:F(i.value)},[E(c(V))],4)):C("",!0)],512))],2)):C("",!0)}});var je=O(Ge,[["__scopeId","data-v-ac52853e"]]);const Ze=z({__name:"wrapper",setup(t){let e=p(Date.now());return[B.JSON,B.CHART].forEach(n=>{!window.opener||window.opener.addEventListener(n,s=>S(this,null,function*(){const o=yield U();ye(_e.GO_CHART_STORAGE_LIST,[M(h({},s.detail),{id:o.id})]),e.value=Date.now()}))}),(n,s)=>(w(),f(je,{key:c(e)}))}});export{Ze as default};
